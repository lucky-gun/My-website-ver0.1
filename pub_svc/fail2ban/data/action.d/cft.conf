[Definition]
actionstart =
actionstop =
actioncheck =
actionban = curl -s -X POST "<_cf_api_url>" \
              <_cf_api_prms> \
              --data '{"mode":"<cfmode>","configuration":{"target":"<cftarget>","value":"<ip>"},"notes":"<notes>"}'
# === 최소 수정 드롭인 ===
actionunban = enc_notes="<notes>"; enc_notes="${enc_notes// /%%20}"; \
              id=$(curl -s -X GET "<_cf_api_url>?notes=$enc_notes&configuration_target=<cftarget>&configuration_value=<ip>" \
                       <_cf_api_prms> \
                     | awk -F"[,:}]" '{for(i=1;i<=NF;i++){if($i~/\"id\"/){print $(i+1); exit}}}' \
                     | tr -d ' "'); \
              if [ -z "$id" ]; then echo "<name>: id for <ip> cannot be found using target <cftarget>"; exit 0; fi; \
              curl -s -X DELETE "<_cf_api_url>/$id" \
                  <_cf_api_prms> \
                  --data '{"cascade":"none"}'


_cf_api_url = https://api.cloudflare.com/client/v4/zones/<cfzone>/firewall/access_rules/rules
_cf_api_prms = -H "Authorization: Bearer <cftoken>" -H "Content-Type: application/json"

[Init]
cfzone = 3dd199cdcbccf530b4d860796dff4e34
cftoken = W50Fs-7sb5HikltJxcVLO2EpJiXfg1xwmqpNo6AG
cftarget = ip
cfmode = block
notes = Fail2Ban <name>

[Init?family=inet6]
cftarget = ip6
