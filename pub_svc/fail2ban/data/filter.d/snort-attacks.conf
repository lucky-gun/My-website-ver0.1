# Snort alert.fast -> Fail2Ban (inbound only)
# Inbound 판단: {PROTO} SRC[:PORT] -> DST[:PORT] 에서 DST가 내부망(IP)
# 예: {ICMP} 40.124.81.157 -> 10.0.0.100  (✅ 잡음)
#     {ICMP} 10.0.0.100 -> 84.247.151.100 (❌ 무시: outbound)
[Definition]
# Snort alert.fast / alert.full 공통 매칭
# - [DDoS] SYN flood to web
# - [DDoS] TLS ClientHello flood
# - [DDoS] ICMP echo flood
# 대상: 내부 RFC1918(10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16)

# 내부망 캡처용 정규식(재사용을 위해 주석으로 표기)
#   (?P<RFC1918>(?:10\.\d{1,3}\.\d{1,3}\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|172\.(?:1[6-9]|2\d|3[0-1])\.\d{1,3}\.\d{1,3}))

failregex =
    ^.*\[DDoS\]\s+SYN flood to web.*\{TCP\}\s+<HOST>:\d+\s+->\s+(?:10\.\d{1,3}\.\d{1,3}\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|172\.(?:1[6-9]|2\d|3[0-1])\.\d{1,3}\.\d{1,3}):(?:80|443|3000)\b
    ^.*\[DDoS\]\s+TLS ClientHello flood.*\{TCP\}\s+<HOST>:\d+\s+->\s+(?:10\.\d{1,3}\.\d{1,3}\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|172\.(?:1[6-9]|2\d|3[0-1])\.\d{1,3}\.\d{1,3}):(?:443|3000)\b
    ^.*\[DDoS\]\s+ICMP echo flood.*\{ICMP\}\s+<HOST>\s+->\s+(?:10\.\d{1,3}\.\d{1,3}\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|172\.(?:1[6-9]|2\d|3[0-1])\.\d{1,3}\.\d{1,3})\b

# 안전장치: 내부망이 SRC(아웃바운드)인 경우는 무시
ignoreregex =
    ^.*\{(?:TCP|UDP)\}\s+(?:10\.\d{1,3}\.\d{1,3}\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|172\.(?:1[6-9]|2\d|3[0-1])\.\d{1,3}\.\d{1,3}):\d+\s+->\s+
    ^.*\{ICMP\}\s+(?:10\.\d{1,3}\.\d{1,3}\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|172\.(?:1[6-9]|2\d|3[0-1])\.\d{1,3}\.\d{1,3})\s+->\s+
