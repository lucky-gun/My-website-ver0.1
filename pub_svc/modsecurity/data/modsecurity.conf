# /etc/modsecurity/modsecurity.conf  (예시)
SecRuleEngine On

# 요청 바디 검사 On, 응답 바디 Off (이미지/프리뷰 과부하 방지)
SecRequestBodyAccess On
SecResponseBodyAccess Off

# 운영용 감사 로그 (필요 시 RelevantOnly → On 으로 상향)
SecAuditEngine RelevantOnly
SecAuditLogParts ABIFHZ
SecAuditLogType Serial
SecAuditLogFormat JSON
SecAuditLog /var/log/modsecurity/audit.log
# 디버그는 기본 Off (문제시 잠깐 3~5로)
SecDebugLog /var/log/modsecurity/debug.log
SecDebugLogLevel 0

# ── CRS & Plugins Include (순서 중요) ─────────────────────
Include /etc/modsecurity/00-local-whitelist.conf
Include /etc/modsecurity/crs/crs-setup.conf
Include /etc/modsecurity/crs/plugins/*-config.conf
Include /etc/modsecurity/crs/plugins/*-before.conf
Include /etc/modsecurity/crs/rules/*.conf
Include /etc/modsecurity/crs/plugins/*-after.conf
# ─────────────────────────────────────────────────────────

# (선택) 초기 튜닝 동안 완화 → 안정화 후 5~7로 내리기
SecAction "id:900110,phase:1,pass,nolog,setvar:tx.inbound_anomaly_score_threshold=10,setvar:tx.outbound_anomaly_score_threshold=4"
